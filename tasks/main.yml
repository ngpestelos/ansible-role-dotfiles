---
- name: Create dotfiles directory
  file:
    path: "{{ dotfiles_path }}"
    state: directory

- name: Clone dotfiles
  shell: "git init && git pull {{ dotfiles_url }} chdir={{ dotfiles_path }}"

- name: Update submodules
  shell: "git submodule update --init chdir={{ dotfiles_path }}"

- name: Remove existing symlinks
  shell: "make clean chdir={{ dotfiles_path }}"
  sudo_user: deploy

- name: Install dotfiles
  shell: "make install chdir={{ dotfiles_path }}"
  sudo_user: deploy